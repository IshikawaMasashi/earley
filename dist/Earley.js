!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Earley=e():t.Earley=e()}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(2)),s=function(){function t(t,e,r,n){this.id=t,this.text=e,this.location=new i.default(r,n)}return t.prototype.toString=function(){return"Token("+this.text+")"},t}();e.Token=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=0;e.getNextStateId=function(){return n++},e.POST_NEWLINE=-1,e.PRE_NEWLINE=-2,e.DIGIT_CHAR=-3,e.ANY_CHAR=-4;var i=function(){function t(t){this.mchar=t}return t.prototype.match=function(t){return this.mchar==e.DIGIT_CHAR?t>="0"&&t<="9":this.mchar==e.ANY_CHAR?t!==e.POST_NEWLINE&&t!==e.PRE_NEWLINE&&"\n"!=t:t==this.mchar},t.prototype.toString=function(){return this.mchar==e.DIGIT_CHAR?"\\d":this.mchar},t}();e.CharMatcher=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.line=t,this.position=e}return t.prototype.toString=function(){return this.line+1+":"+(this.position+1)},t}();e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(6),i=r(0),s=function(){function t(t,e){this.dbg=e,this.errors=[],this.debug=!1,this.tokenizer=t.createTokenizer(e),this.EPSILON=t.EPSILON,t.computeFirst(),this.rules=t.rules,this.first=t.first}return t.prototype.getNonTerminal=function(t){return this.rules[t]},t.prototype.getRegexFromTerminal=function(t){return t.substr(1,t.length-2)},t.prototype.isTerminal=function(t){return void 0!==t&&"'"==t[0]},t.prototype.isNonTerminal=function(t){return void 0!==t&&"'"!=t[0]},t.prototype.parse=function(t){var e,r=this.dbg,i=[[new n.EarleyItem(this.rules._start[0],0,0)]],s=0,o=0;this.tokenizer.setText(t),this.errors=[];for(var a=0;;a++){var u=this.tokenizer.nextToken(s,o);if(null===u)return this.errors.push("Bad token at "+s+":"+o+"\n"),r.printf("Bad token!\n"),null;this.debug&&r.printf("Got token %s at %s\n",u,u.location),this.location=u.location,i.push([]);for(var h=0;h<i[a].length;)this.predict(i[a],h,a,u),this.complete(i,a,h,a),h++;if(this.scan(i,a,u),0===i[a].length){for(this.errors.push("Syntax error at "+this.location+": "+u),e=0;e<i[a-1].length;e++)this.errors.push("    "+i[a-1][e]+"\n");break}if(this.debug&&this.printState(i,a),s=u.location.line,o=u.location.position+u.text.length,u.id===this.tokenizer.EOF_TOKEN){a++;break}}if(this.debug&&this.printState(i,a),i[a].length)return this.evaluate(i[a][0]);for(this.errors.push("Syntax error at "+this.location),e=0;e<i[a-1].length;e++)this.errors.push("    "+i[a-1][e]+"\n");return null},t.prototype.predict=function(t,e,r,n){var i=t[e];if(this.isNonTerminal(i.rule.symbols[i.pos]))for(var s=this.getNonTerminal(i.rule.symbols[i.pos]),o=0;o<s.length;o++){var a=s[o];(0===a.symbols.length||"'"===a.symbols[0][0]||this.first[a.symbols[0]][n.id]||this.first[a.symbols[0]][this.EPSILON])&&this.addToState(t,a,0,r,void 0,void 0)}},t.prototype.complete=function(t,e,r,n){var i=t[e][r];if(i.pos==i.rule.symbols.length)for(var s=t[i.base],o=0;o<s.length;o++)s[o].rule.symbols[s[o].pos]==i.rule.name&&this.addToState(t[e],s[o].rule,s[o].pos+1,s[o].base,i,s[o])},t.prototype.scan=function(t,e,r){for(var i=t[e],s=0;s<i.length;s++)i[s].rule.symbols[i[s].pos]==r.id&&t[e+1].push(new n.EarleyItem(i[s].rule,i[s].pos+1,i[s].base,r,i[s],this.location))},t.prototype.addToState=function(t,e,r,i,s,o){for(var a=0;a<t.length;a++)if(t[a].rule===e&&t[a].pos===r&&t[a].base===i)return;t.push(new n.EarleyItem(e,r,i,s,o,this.location))},t.prototype.printState=function(t,e){var r=this.dbg;if(this.debug){var n=t[e];r.printf("State [%d]\n",e);for(var i=0;i<n.length;i++)r.printf("%s\n",n[i]);r.printf("\n")}},t.prototype.evaluate=function(t){if(!t)return null;for(var e=[],r=t,n=t.location;r;)r.token instanceof i.Token?e.unshift(r.token.text):r.token&&e.unshift(this.evaluate(r.token)),n=r.location,r=r.prev;return t.rule.action?t.rule.action(e,n):e[0]},t}();e.EarleyParser=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2);e.Location=n.default;var i=r(5);e.TreeNode=i.default;var s=r(3);e.default=s.EarleyParser;var o=r(7);e.RuleParser=o.RuleParser},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){this.location=t};e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=0,s=function(){function t(t,e,r,n,s,o){this.rule=t,this.pos=e,this.base=r,this.token=n,this.prev=s,this.location=o,this.id=i++}return t.prototype.toString=function(){for(var t="["+this.id+"] "+this.rule.name+":",e=0;e<this.rule.symbols.length;e++)e==this.pos&&(t+=" ."),t+=" "+this.rule.symbols[e];return e==this.pos&&(t+=" ."),t+=", "+this.base,this.token instanceof n.Token?t+=", token="+this.token.text:this.token&&(t+=", rule="+this.token.rule),this.prev&&(t+=", prev="+this.prev.id),t},t}();e.EarleyItem=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(8),i=r(3),s=function(){function t(t){var e=this;this.nextRuleId=0,this.buildSet=new n.RuleSet;var r=new n.RuleSet;r.addRule("start",["rule"]),r.addRule("identifier",["'[A-Za-z0-9_]+'"]),r.addRule("terminal",["''([^'\\\\]|\\\\.)*''"]),r.addRule("expr",["or_expr"]),r.addRule("rule",["identifier","':'","expr"],function(t){return e.buildSet.addRule(t[0],t[2],e.action),t[0]}),r.addRule("rule",["identifier","':'"],function(t){return e.buildSet.addRule(t[0],[],e.action),t[0]}),r.addRule("or_expr",["or_expr","'\\|'","cat_expr"],function(t){var r="_"+e.nextRuleId++;return e.buildSet.addRule(r,t[0]),e.buildSet.addRule(r,t[2]),[r]}),r.addRule("or_expr",["cat_expr"]),r.addRule("cat_expr",["cat_expr","list_expr"],function(t){return t[0].push(t[1]),t[0]}),r.addRule("cat_expr",["list_expr"],function(t){return[t[0]]}),r.addRule("list_expr",["kleene_expr"]),r.addRule("list_expr",["'\\['","kleene_expr","','","kleene_expr","'\\]'"],function(t){var r="_"+e.nextRuleId++,n="_"+e.nextRuleId++;return e.buildSet.addRule(r,[n]),e.buildSet.addRule(r,[],function(t){return[]}),e.buildSet.addRule(n,[t[1]],function(t){return t}),e.buildSet.addRule(n,[n,t[3],t[1]],function(t){return t[0].push(t[2]),t[0]}),r}),r.addRule("kleene_expr",["basic_expr","'[\\+\\*\\?]'"],function(t){var r="_"+e.nextRuleId++;if("*"==t[1])e.buildSet.addRule(r,[r,t[0]],function(t){return t[0].push(t[1]),t[0]}),e.buildSet.addRule(r,[],function(t){return[]});else if("?"==t[1])e.buildSet.addRule(r,[t[0]]),e.buildSet.addRule(r,[],function(t){return null});else if("+"==t[1]){var n="_"+e.nextRuleId++;e.buildSet.addRule(r,[n,t[0]]),e.buildSet.addRule(n,[n,t[0]]),e.buildSet.addRule(n,[])}return r}),r.addRule("kleene_expr",["basic_expr"]),r.addRule("basic_expr",["identifier"]),r.addRule("basic_expr",["'\\('","expr","'\\)'"],function(t){var r="_"+e.nextRuleId++;return e.buildSet.addRule(r,t[1]),r}),r.addRule("basic_expr",["terminal"]),r.finalize(),this.parser=new i.EarleyParser(r,t)}return t.prototype.addToken=function(t,e){this.buildSet.addToken(t,e)},t.prototype.addRule=function(t,e){this.action=e,this.parser.parse(t)},t}();e.RuleParser=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(9),i=r(14),s=function(){function t(){this.rules={},this.terminals=[],this.terminalsAdded={},this.first={},this.eatWhiteSpace=!0,this.EOF_TOKEN="'!EOF'",this.follow={},this.EPSILON="EPSILON",this.eatWhiteSpace?this.joinExpr=" *":this.joinExpr="",this.addRule("_start",["start",this.EOF_TOKEN])}return t.prototype.toString=function(){var t="";for(var e in this.rules)for(var r=this.rules[e],n=0;n<r.length;n++)t+=r[n].toString()+"\n";return t},t.prototype.check=function(t){var e=t.length;for(var r in this.rules)for(var n=this.rules[r],i=0;i<n.length;i++)for(var s=n[i],o=0;o<s.symbols.length;o++){var a=s.symbols[o];0===a.length?t.push("Error: Rule '"+r+"' contains a zero length symbol: "+a):"'"!=a[0]&&void 0===this.rules[a]&&t.push("Error: Rule'"+r+"' contains an undefined symbol: "+a)}return t.length-e},t.prototype.optimize=function(){for(var t=1;t;)for(var e in t=0,this.rules){var r=this.rules[e];1!=r.length||"_start"==r[0].name||r[0].action||(this.replaceRule(r[0].name,r[0].symbols),t|=1)}},t.prototype.innerExpr=function(t){return t.substr(1,t.length-2)},t.prototype.replaceRule=function(t,e){for(var r in delete this.rules[t],this.rules)for(var n=this.rules[r],i=0;i<n.length;i++)for(var s=0;s<n[i].symbols.length;s++)if(n[i].symbols[s]==t){n[i].symbols.splice(s,1);for(var o=0;o<e.length;o++)n[i].symbols.splice(s+o,0,e[o]);s+=e.length-1}},t.prototype.addRule=function(t,e,r){void 0===this.rules[t]&&(this.rules[t]=[]),this.rules[t].push(new i.Rule(t,e,r));for(var n=0;n<e.length;n++)e.length>0&&"'"==e[n][0]&&!this.terminalsAdded[e[n]]&&(this.terminalsAdded[e[n]]=1,this.terminals.push(e[n]))},t.prototype.addToken=function(t,e){this.addRule(t,["'"+e+"'"])},t.prototype.computeFirst=function(){var t;for(t in this.first={},this.rules)this.first[t]={};var e=!0,r=this;function n(t,e){var n=!(e in r.first[t]);return r.first[t][e]=1,n}function i(t,e){var i=!1;for(var s in r.first[e])i=i||n(t,s);return i}for(;e;)for(t in e=!1,this.rules)for(var s=this.rules[t],o=0;o<s.length;o++){0===s[o].symbols.length&&(e=e||n(t,this.EPSILON));for(var a=0;a<s[o].symbols.length;a++){if("'"==s[o].symbols[a][0]){e=e||n(t,s[o].symbols[a]);break}if(e=e||i(t,s[o].symbols[a]),1!==this.first[s[o].symbols[a]][this.EPSILON])break}}},t.prototype.computeFollow=function(){for(var t in this.follow={},this.rules)this.follow[t]={};for(var e=!0;e;){var r;for(var n in e=!1,this.rules)for(var i=this.rules[n],s=0;s<i.length;s++)for(var o=i[s],a=0;a<o.symbols.length;a++)if("'"!==o.symbols[a][0]){var u=this.follow[o.symbols[a]];if(a==o.symbols.length-1){if("'"!=o.symbols[a][0]&&o.symbols[a]!=n)for(r in this.follow[n])r!==this.EPSILON&&(e=e||void 0===u[r],u[r]=1)}else if("'"==o.symbols[a+1][0]||o.symbols[a+1]===this.EOF_TOKEN)e=e||void 0===u[o.symbols[a+1]],u[o.symbols[a+1]]=1;else for(r in this.first[o.symbols[a+1]])r!==this.EPSILON&&(e=e||void 0===u[r],u[r]=1)}}},t.prototype.finalize=function(){this.optimize(),this.computeFirst(),this.computeFollow()},t.prototype.createTokenizer=function(t){var e=new n.Tokenizer(t);e.ignore("[ \t\r]+");for(var r=0;r<this.terminals.length;r++)e.addToken(this.terminals[r],this.innerExpr(this.terminals[r]));return e.EOF_TOKEN=this.EOF_TOKEN,e},t}();e.RuleSet=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(10),i=r(11),s=r(12),o=r(1),a=r(13),u=r(0),h=function(){function t(t){this.dbg=t,this.root=new n.NfaState,this.index=0,this.listId=1,this.dfaCache={},this.text="",this.lineNumbers=[],this.EOF_TOKEN={},this.IGNORE_TOKEN={},this.finished=!0}return t.prototype.addToken=function(t,e){this.expr=e,this.index=0;var r=this.parseAlternation();this.root.next.push(r.start),r.end.accept=t},t.prototype.ignore=function(t){this.addToken(this.IGNORE_TOKEN,t)},t.prototype.eof=function(){return this.index==this.expr.length},t.prototype.matchChar=function(t){return this.expr[this.index]==t&&(this.index++,!0)},t.prototype.peek=function(t){return this.expr[this.index]==t},t.prototype.parseChar=function(){return this.matchChar("\\")?this.matchChar("n")?"\n":this.matchChar("r")?"\r":this.matchChar("t")?"\t":this.matchChar("d")?o.DIGIT_CHAR:this.expr[this.index++]:this.matchChar(".")?o.ANY_CHAR:this.matchChar("$")?o.PRE_NEWLINE:this.matchChar("^")?o.POST_NEWLINE:this.expr[this.index++]},t.prototype.parseRange=function(){for(var t=!0,e=[];!this.eof()&&!this.peek("]");){this.matchChar("^")&&(t=!1);var r=this.parseChar(),s=r;this.matchChar("-")&&(s=this.parseChar()),r==o.DIGIT_CHAR&&(r="0",s="9"),e.push([r,s])}var u=new n.NfaState(new a.RangeMatcher(e,t));return new i.NFA(u,u)},t.prototype.parseBasic=function(){var t;if(this.matchChar("(")){if(t=this.parseAlternation(),!this.matchChar(")"))throw"Expected ')'"}else if(this.matchChar("[")){if(t=this.parseRange(),!this.matchChar("]"))throw"Expected ']'"}else{var e=new n.NfaState(new o.CharMatcher(this.parseChar()));t=new i.NFA(e,e)}return t},t.prototype.parseKleene=function(){var t=this.parseBasic();if(this.matchChar("+")){var e=new n.NfaState;t.end.next.push(e),e.next.push(t.start),t.end=e}else if(this.matchChar("*")){(e=new n.NfaState).next.push(t.start),t.end.next.push(e),t.start=e,t.end=e}else if(this.matchChar("?")){var r=new n.NfaState,i=new n.NfaState;r.next.push(t.start),r.next.push(i),t.end.next.push(i),t.start=r,t.end=i}return t},t.prototype.parseConcat=function(){for(var t=new n.NfaState,e=t;!(this.peek("|")||this.peek(")")||this.eof());){var r=this.parseKleene();e.next.push(r.start),e=r.end}return new i.NFA(t,e)},t.prototype.parseAlternation=function(){var t=new n.NfaState,e=new n.NfaState;do{var r=this.parseConcat();t.next.push(r.start),r.end.next.push(e)}while(this.matchChar("|"));return new i.NFA(t,e)},t.prototype.addState=function(t,e,r){if(r.lastList!=this.listId&&(void 0!==r.accept&&e.push(r.accept),r.lastList=this.listId,t.push(r),void 0===r.mchar))for(var n=0;n<r.next.length;n++)this.addState(t,e,r.next[n])},t.prototype.nextState=function(t,e){var r,n=[],i=[];for(this.listId++,r=0;r<t.nfaStates.length;r++){var a=t.nfaStates[r];void 0!==a.mchar&&(a.mchar.match(e)?this.addState(n,i,a.next[0]):e!=o.PRE_NEWLINE&&e!=o.POST_NEWLINE||this.addState(n,i,a))}n.sort(function(t,e){return t.id-e.id});var u="";for(r=0;r<n.length;r++)u+=n[r].id+".";return void 0===this.dfaCache[u]&&((t=new s.DfaState).nfaStates=n,t.accepts=i,this.dfaCache[u]=t),this.dfaCache[u]},t.prototype.setText=function(t){this.text=t,this.lineNumbers.length=0,this.lineNumbers.push(0),this.finished=!1;for(var e=0;e<this.text.length;e++)"\n"==this.text[e]&&this.lineNumbers.push(e+1)},t.prototype.getLine=function(t){return this.text.substr(this.lineNumbers[t],this.lineNumbers[t+1]-this.lineNumbers[t])},t.prototype.nextTokenInternal=function(t,e){this.dbg;var r,n=0,i=null;void 0===this.rootDfa&&(this.rootDfa=new s.DfaState,this.addState(this.rootDfa.nfaStates,this.rootDfa.accepts,this.root));var a=this.rootDfa,h=this.lineNumbers[t]+e;if(h==this.text.length)return this.finished=!0,new u.Token(this.EOF_TOKEN,"!EOF",t,e);for(h>0&&(n=this.text[h-1]),r=h;r<this.text.length;r++){var l=this.text[r];if("\n"===l&&n!=o.PRE_NEWLINE?(l=o.PRE_NEWLINE,r--):"\n"!==n&&0!==n||(l=o.POST_NEWLINE,r--),"\n"===n&&t++,n=l,void 0===a.next[l]&&(a.next[l]=this.nextState(a,l)),(a=a.next[l]).accepts.length&&(i=new u.Token(a.accepts[0],this.text.substr(h,r-h+1),t,h-this.lineNumbers[t])),0===a.nfaStates.length)break}return i},t.prototype.nextToken=function(t,e){for(;;){var r=this.nextTokenInternal(t,e);if(null===r||r.id!==this.IGNORE_TOKEN)return r;t=r.location.line,e=r.location.position+r.text.length}},t}();e.Tokenizer=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){function t(t){this.next=[],this.id=n.getNextStateId(),this.lastList=0,this.accept=void 0,this.mchar=t}return t.prototype.toString=function(){var t="\nState ["+this.id+"] ch="+this.mchar+"\n";void 0!==this.accept&&(t+="    Accept "+this.accept+"\n");for(var e=0;e<this.next.length;e++)t+="    ch="+this.next[e].mchar+" goto ["+this.next[e].id+"]\n";return t},t}();e.NfaState=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.toString=function(){for(var t={},e=[this.start],r="";e.length>0;){var n=e.pop();if(!t[n]){t[n]=1;for(var i=0;i<n.next.length;i++)e.push(n.next[i]);r+=n.toString()}}return r},t}();e.NFA=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),i=function(){this.nfaStates=[],this.next={},this.accepts=[],this.id=n.getNextStateId()};e.DfaState=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.ranges=t,this.include=e}return t.prototype.match=function(t){for(var e=0;e<this.ranges.length;e++){var r=this.ranges[e];if(t>=r[0]&&t<=r[1])return this.include}return!this.include},t.prototype.toString=function(){var t="[";this.include||(t+="^");for(var e=0;e<this.ranges.length;e++)this.ranges[e][0]==this.ranges[e][1]?t+=this.ranges[e][0]:t+=this.ranges[e][0]+"-"+this.ranges[e][1];return t+"]"},t}();e.RangeMatcher=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=0,i=function(){function t(t,e,r){this.name=t,this.symbols=e,this.action=r,this.id=n++}return t.prototype.toString=function(){for(var t=this.name+":",e=0;e<this.symbols.length;e++)t+=" "+this.symbols[e];return t},t}();e.Rule=i}])});
//# sourceMappingURL=Earley.js.map